{% extends 'base.html' %}

{% block script %}

    {{ block.super }}
    <script type="text/javascript">

        $('body').on('click', '.next_page', function(event){

            event.preventDefault();

            $.ajax({
                url:        $(this).attr('href'),
                type:       'get',
                dataType:   'json',
                success:    (function(next_page_link){return function(data){
                    $('#news_list').append(data.news_data);
                    if (data.next_page) {
                        next_page_link.attr('href', '?page='+data.next_page);
                    } else {
                        next_page_link.hide()
                    }
                };})($(this))
            })

        }).on('scoll', function(){

            var more_link = $('.next_page');
            more_link.position()

        })

    </script>

{% endblock %}

{% block content %}

    <h1>Новости</h1>
    <p>К сожалению, сделать подгрузки при прокрутке я не успеваю (</p>

    <ul id="news_list">
        {% include 'inc/news_list.html' with news=news %}
    </ul>

    {% if next_page %}
        <a href="{% url 'news_list' %}?page={{ next_page }}" class="next_page">Далее</a>
    {% endif %}

{% endblock %}